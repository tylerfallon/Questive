{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"lodash","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"_"}]},{"source":"../../fields/utils/set_defaults.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"setDefaults"}]},{"source":"../../fields/utils/cast_nested.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"castNested"}]},{"source":"../../events/event.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Event"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js","filenameRelative":"/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js.map","sourceFileName":"/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"reload"},"ignored":false,"code":"var _;module.import('lodash',{\"default\":function(v){_=v}});var setDefaults;module.import('../../fields/utils/set_defaults.js',{\"default\":function(v){setDefaults=v}});var castNested;module.import('../../fields/utils/cast_nested.js',{\"default\":function(v){castNested=v}});var Event;module.import('../../events/event.js',{\"default\":function(v){Event=v}});\n\n\n\n\nfunction reload() {\n\t\tvar doc = this;\n\t\tvar Class = doc.constructor;\n\n\t\t// The document has to be already saved in the collection.\n\t\tif (!doc._isNew) {\n\t\t\t\t(function () {\n\t\t\t\t\t\t// Get a document from the collection without transformation.\n\t\t\t\t\t\tvar rawDoc = Class.findOne(doc._id, {\n\t\t\t\t\t\t\t\ttransform: null\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Trigger the \"beforeInit\" event handlers.\n\t\t\t\t\t\tdoc.dispatchEvent(new Event('beforeInit'));\n\n\t\t\t\t\t\t// Set all fields.\n\t\t\t\t\t\tvar fields = Class.getFields();\n\t\t\t\t\t\t_.each(fields, function (field) {\n\t\t\t\t\t\t\t\tdoc[field.name] = field.resolveValue(rawDoc);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Set default values if the \"defaults\" option is set.\n\t\t\t\t\t\tsetDefaults({\n\t\t\t\t\t\t\t\tdoc: doc\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Cast nested documents.\n\t\t\t\t\t\tcastNested({\n\t\t\t\t\t\t\t\tdoc: doc\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Trigger the \"afterInit\" event handlers.\n\t\t\t\t\t\tdoc.dispatchEvent(new Event('afterInit'));\n\n\t\t\t\t\t\t// Mark the document as not new.\n\t\t\t\t\t\tdoc._isNew = false;\n\t\t\t\t})();\n\t\t}\n};\n\nmodule.export(\"default\",exports.default=(reload));","ast":null,"map":{"version":3,"sources":["/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js"],"names":[],"mappings":"AAAA,OAAO,CAAP,MAAc,QAAd;AACA,OAAO,WAAP,MAAwB,oCAAxB;AACA,OAAO,UAAP,MAAuB,mCAAvB;AACA,OAAO,KAAP,MAAkB,uBAAlB;;AAEA,SAAS,MAAT,GAAkB;AACjB,MAAM,MAAM,IAAZ;AACA,MAAM,QAAQ,IAAI,WAAlB;;;AAGA,MAAI,CAAC,IAAI,MAAT,EAAiB;AAAA;;AAEhB,UAAM,SAAS,MAAM,OAAN,CAAc,IAAI,GAAlB,EAAuB;AACrC,mBAAW;AAD0B,OAAvB,CAAf;;;AAKA,UAAI,aAAJ,CAAkB,IAAI,KAAJ,CAAU,YAAV,CAAlB;;;AAGA,UAAM,SAAS,MAAM,SAAN,EAAf;AACE,QAAE,IAAF,CAAO,MAAP,EAAe,UAAC,KAAD,EAAW;AACxB,YAAI,MAAM,IAAV,IAAkB,MAAM,YAAN,CAAmB,MAAnB,CAAlB;AACD,OAFD;;;AAKA,kBAAY;AACV;AADU,OAAZ;;AAIA,iBAAW;AACT;AADS,OAAX;;;AAKF,UAAI,aAAJ,CAAkB,IAAI,KAAJ,CAAU,WAAV,CAAlB;;;AAGA,UAAI,MAAJ,GAAa,KAAb;AA5BgB;AA6BhB;AACD;;AAED,eAAe,MAAf","file":"/packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/reload.js.map","sourcesContent":["import _ from 'lodash';\nimport setDefaults from '../../fields/utils/set_defaults.js';\nimport castNested from '../../fields/utils/cast_nested.js';\nimport Event from '../../events/event.js';\n\nfunction reload() {\n\tconst doc = this;\n\tconst Class = doc.constructor;\n\n\t// The document has to be already saved in the collection.\n\tif (!doc._isNew) {\n\t\t// Get a document from the collection without transformation.\n\t\tconst rawDoc = Class.findOne(doc._id, {\n\t\t\ttransform: null\n\t\t});\n\n\t\t// Trigger the \"beforeInit\" event handlers.\n\t\tdoc.dispatchEvent(new Event('beforeInit'));\n\n\t\t// Set all fields.\n\t\tconst fields = Class.getFields();\n    _.each(fields, (field) => {\n      doc[field.name] = field.resolveValue(rawDoc);\n    });\n\n    // Set default values if the \"defaults\" option is set.\n    setDefaults({\n      doc\n    });\n    // Cast nested documents.\n    castNested({\n      doc\n    });\n\n\t\t// Trigger the \"afterInit\" event handlers.\n\t\tdoc.dispatchEvent(new Event('afterInit'));\n\n\t\t// Mark the document as not new.\n\t\tdoc._isNew = false;\n\t}\n};\n\nexport default reload;"]},"hash":"07d083c502c7764e3a0938cc2bead1d96d3f3876"}
