{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"lodash","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"_"}]},{"source":"../event.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"Event"}]},{"source":"../../core/utils/throw_parse_error.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"throwParseError"}]},{"source":"../../../core/class.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"AstroClass"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js","filenameRelative":"/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js.map","sourceFileName":"/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"dispatch_event"},"ignored":false,"code":"var _;module.import('lodash',{\"default\":function(v){_=v}});var Event;module.import('../event.js',{\"default\":function(v){Event=v}});var throwParseError;module.import('../../core/utils/throw_parse_error.js',{\"default\":function(v){throwParseError=v}});var AstroClass;module.import('../../../core/class.js',{\"default\":function(v){AstroClass=v}});\n\n\n\n\nfunction returnFromDispatchEvent(event) {\n  // If an event is cancelable and it had been canceled with the\n  // \"preventDefault\" method call, then we return false.\n  if (event.cancelable) {\n    return !event.defaultPrevented;\n  }\n  return true;\n}\n\nfunction dispatchEvent(event) {\n  var doc = this;\n  var Class = doc.constructor;\n\n  if (!Match.test(event, Event)) {\n    throwParseError([{\n      'class': Class.getName()\n    }, {\n      'method': 'dispatchEvent'\n    }, 'The first argument has to be an event object']);\n  }\n\n  // Attach a document to the event as a target.\n  if (event.target === null) {\n    event.target = doc;\n  }\n  if (event.currentTarget === null) {\n    event.currentTarget = doc;\n  }\n\n  // Get all event handlers of a given type.\n  var eventHandlers = Class.getEvents(event.type);\n\n  _.every(eventHandlers, function (eventHandler) {\n    eventHandler(event);\n\n    // Stop execution of the following event handlers, if a flag is set.\n    return !event.immediatePropagationStopped;\n  });\n\n  // If propagation was stopped or bubbling is turned off, then we don't go\n  // deeper into nested fields.\n  if (event.propagationStopped || !event.propagates) {\n    return returnFromDispatchEvent(event);\n  }\n\n  // Object fields.\n  _.each(Class.getObjectFields(), function (field) {\n    var value = doc[field.name];\n    if (value instanceof AstroClass) {\n      event.currentTarget = value;\n      value.dispatchEvent(event);\n    }\n  });\n\n  // List fields.\n  _.each(Class.getListFields(), function (field) {\n    var value = doc[field.name];\n    if (field.isClass && _.isArray(value)) {\n      _.each(value, function (element) {\n        if (element instanceof AstroClass) {\n          event.currentTarget = element;\n          element.dispatchEvent(event);\n        }\n      });\n    }\n  });\n\n  return returnFromDispatchEvent(event);\n}\n\nmodule.export(\"default\",exports.default=(dispatchEvent));","ast":null,"map":{"version":3,"sources":["/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js"],"names":[],"mappings":"AAAA,OAAO,CAAP,MAAc,QAAd;AACA,OAAO,KAAP,MAAkB,aAAlB;AACA,OAAO,eAAP,MAA4B,uCAA5B;AACA,SAAS,WAAW,UAApB,QAAsC,wBAAtC;;AAEA,SAAS,uBAAT,CAAiC,KAAjC,EAAwC;;;AAGtC,MAAI,MAAM,UAAV,EAAsB;AACpB,WAAO,CAAC,MAAM,gBAAd;AACD;AACD,SAAO,IAAP;AACD;;AAED,SAAS,aAAT,CAAuB,KAAvB,EAA8B;AAC5B,MAAM,MAAM,IAAZ;AACA,MAAM,QAAQ,IAAI,WAAlB;;AAEA,MAAI,CAAC,MAAM,IAAN,CAAW,KAAX,EAAkB,KAAlB,CAAL,EAA+B;AAC7B,oBAAgB,CAAC;AACb,eAAS,MAAM,OAAN;AADI,KAAD,EAEX;AACD,gBAAU;AADT,KAFW,EAKd,8CALc,CAAhB;AAOD;;;AAGD,MAAI,MAAM,MAAN,KAAiB,IAArB,EAA2B;AACzB,UAAM,MAAN,GAAe,GAAf;AACD;AACD,MAAI,MAAM,aAAN,KAAwB,IAA5B,EAAkC;AAChC,UAAM,aAAN,GAAsB,GAAtB;AACD;;;AAGD,MAAM,gBAAgB,MAAM,SAAN,CAAgB,MAAM,IAAtB,CAAtB;;AAEA,IAAE,KAAF,CAAQ,aAAR,EAAuB,UAAS,YAAT,EAAuB;AAC5C,iBAAa,KAAb;;;AAGA,WAAO,CAAC,MAAM,2BAAd;AACD,GALD;;;;AASA,MAAI,MAAM,kBAAN,IAA4B,CAAC,MAAM,UAAvC,EAAmD;AACjD,WAAO,wBAAwB,KAAxB,CAAP;AACD;;;AAGD,IAAE,IAAF,CAAO,MAAM,eAAN,EAAP,EAAgC,UAAS,KAAT,EAAgB;AAC9C,QAAI,QAAQ,IAAI,MAAM,IAAV,CAAZ;AACA,QAAI,iBAAiB,UAArB,EAAiC;AAC/B,YAAM,aAAN,GAAsB,KAAtB;AACA,YAAM,aAAN,CAAoB,KAApB;AACD;AACF,GAND;;;AASA,IAAE,IAAF,CAAO,MAAM,aAAN,EAAP,EAA8B,UAAS,KAAT,EAAgB;AAC5C,QAAI,QAAQ,IAAI,MAAM,IAAV,CAAZ;AACA,QAAI,MAAM,OAAN,IAAiB,EAAE,OAAF,CAAU,KAAV,CAArB,EAAuC;AACrC,QAAE,IAAF,CAAO,KAAP,EAAc,UAAS,OAAT,EAAkB;AAC9B,YAAI,mBAAmB,UAAvB,EAAmC;AACjC,gBAAM,aAAN,GAAsB,OAAtB;AACA,kBAAQ,aAAR,CAAsB,KAAtB;AACD;AACF,OALD;AAMD;AACF,GAVD;;AAYA,SAAO,wBAAwB,KAAxB,CAAP;AACD;;AAED,eAAe,aAAf","file":"/packages/jagi:astronomy/lib/modules/events/class_prototype_methods/dispatch_event.js.map","sourcesContent":["import _ from 'lodash';\nimport Event from '../event.js';\nimport throwParseError from '../../core/utils/throw_parse_error.js';\nimport { default as AstroClass } from '../../../core/class.js';\n\nfunction returnFromDispatchEvent(event) {\n  // If an event is cancelable and it had been canceled with the\n  // \"preventDefault\" method call, then we return false.\n  if (event.cancelable) {\n    return !event.defaultPrevented;\n  }\n  return true;\n}\n\nfunction dispatchEvent(event) {\n  const doc = this;\n  const Class = doc.constructor;\n\n  if (!Match.test(event, Event)) {\n    throwParseError([{\n        'class': Class.getName()\n      }, {\n        'method': 'dispatchEvent'\n      },\n      'The first argument has to be an event object'\n    ]);\n  }\n\n  // Attach a document to the event as a target.\n  if (event.target === null) {\n    event.target = doc;\n  }\n  if (event.currentTarget === null) {\n    event.currentTarget = doc;\n  }\n\n  // Get all event handlers of a given type.\n  const eventHandlers = Class.getEvents(event.type);\n\n  _.every(eventHandlers, function(eventHandler) {\n    eventHandler(event);\n\n    // Stop execution of the following event handlers, if a flag is set.\n    return !event.immediatePropagationStopped;\n  });\n\n  // If propagation was stopped or bubbling is turned off, then we don't go\n  // deeper into nested fields.\n  if (event.propagationStopped || !event.propagates) {\n    return returnFromDispatchEvent(event);\n  }\n\n  // Object fields.\n  _.each(Class.getObjectFields(), function(field) {\n    let value = doc[field.name];\n    if (value instanceof AstroClass) {\n      event.currentTarget = value;\n      value.dispatchEvent(event);\n    }\n  });\n\n  // List fields.\n  _.each(Class.getListFields(), function(field) {\n    let value = doc[field.name];\n    if (field.isClass && _.isArray(value)) {\n      _.each(value, function(element) {\n        if (element instanceof AstroClass) {\n          event.currentTarget = element;\n          element.dispatchEvent(event);\n        }\n      });\n    }\n  });\n\n  return returnFromDispatchEvent(event);\n}\n\nexport default dispatchEvent;"]},"hash":"d899d73a00d4e4cceb5d70aaea1e5d189f7f9e13"}
