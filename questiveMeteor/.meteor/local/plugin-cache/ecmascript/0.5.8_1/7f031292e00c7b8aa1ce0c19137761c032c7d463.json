{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/jagi:astronomy/test/modules/events/propagation.js","filenameRelative":"/packages/jagi:astronomy/test/modules/events/propagation.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/jagi:astronomy/test/modules/events/propagation.js.map","sourceFileName":"/packages/jagi:astronomy/test/modules/events/propagation.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"propagation"},"ignored":false,"code":"Tinytest.add('Modules - Events - Propagation', function (test) {\n  // Reset Astro.\n  reset();\n\n  var expectedEvents = [];\n  var executedEvents = [];\n\n  var PropagationNestedEvent = Astro.Class.create({\n    name: 'PropagationNestedEvent',\n    events: {\n      beforeSave: [function (e) {\n        executedEvents.push('PNE.beforeSave1');\n      }]\n    }\n  });\n\n  var PropagationEvents = new Mongo.Collection(null);\n\n  var PropagationEvent = Astro.Class.create({\n    name: 'PropagationEvent',\n    collection: PropagationEvents,\n    fields: {\n      one: {\n        type: PropagationNestedEvent,\n        'default': function () {\n          function _default() {\n            return new PropagationNestedEvent();\n          }\n\n          return _default;\n        }()\n      },\n      stopPropagation: {\n        type: Boolean\n      },\n      stopImmediatePropagation: {\n        type: Boolean\n      }\n    },\n    events: {\n      beforeSave: [function (e) {\n        var doc = e.currentTarget;\n        executedEvents.push('PE.beforeSave1');\n        if (doc.stopImmediatePropagation) {\n          e.stopImmediatePropagation();\n        } else if (doc.stopPropagation) {\n          e.stopPropagation();\n        }\n      }, function () {\n        executedEvents.push('PE.beforeSave2');\n      }]\n    }\n  });\n\n  // Propagation NOT stopped.\n  executedEvents = [];\n  expectedEvents = ['PE.beforeSave1', 'PE.beforeSave2', 'PNE.beforeSave1'];\n  var eventsPropagation = new PropagationEvent();\n  eventsPropagation.stopPropagation = false;\n  eventsPropagation.stopImmediatePropagation = false;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents, 'Events propagation should not be stopped');\n\n  // Propagation immediately stopped.\n  executedEvents = [];\n  expectedEvents = ['PE.beforeSave1'];\n  eventsPropagation.stopPropagation = false;\n  eventsPropagation.stopImmediatePropagation = true;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents, 'Events propagation should be stopped immediately');\n\n  // Propagation stopped.\n  executedEvents = [];\n  expectedEvents = ['PE.beforeSave1', 'PE.beforeSave2'];\n  eventsPropagation.stopPropagation = true;\n  eventsPropagation.stopImmediatePropagation = false;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents, 'Events propagation should be stopped');\n});","ast":null,"map":{"version":3,"sources":["/packages/jagi:astronomy/test/modules/events/propagation.js"],"names":[],"mappings":"AAAA,SAAS,GAAT,CAAa,gCAAb,EAA+C,UAAS,IAAT,EAAe;;AAE5D;;AAEA,MAAI,iBAAiB,EAArB;AACA,MAAI,iBAAiB,EAArB;;AAEA,MAAI,yBAAyB,MAAM,KAAN,CAAY,MAAZ,CAAmB;AAC9C,UAAM,wBADwC;AAE9C,YAAQ;AACN,kBAAY,CACV,UAAS,CAAT,EAAY;AACV,uBAAe,IAAf,CAAoB,iBAApB;AACD,OAHS;AADN;AAFsC,GAAnB,CAA7B;;AAWA,MAAI,oBAAoB,IAAI,MAAM,UAAV,CAAqB,IAArB,CAAxB;;AAEA,MAAI,mBAAmB,MAAM,KAAN,CAAY,MAAZ,CAAmB;AACxC,UAAM,kBADkC;AAExC,gBAAY,iBAF4B;AAGxC,YAAQ;AACN,WAAK;AACH,cAAM,sBADH;AAEH;AAAS,8BAAW;AAClB,mBAAO,IAAI,sBAAJ,EAAP;AACD;;AAFD;AAAA;AAFG,OADC;AAON,uBAAiB;AACf,cAAM;AADS,OAPX;AAUN,gCAA0B;AACxB,cAAM;AADkB;AAVpB,KAHgC;AAiBxC,YAAQ;AACN,kBAAY,CACV,UAAS,CAAT,EAAY;AACV,YAAI,MAAM,EAAE,aAAZ;AACA,uBAAe,IAAf,CAAoB,gBAApB;AACA,YAAI,IAAI,wBAAR,EAAkC;AAChC,YAAE,wBAAF;AACD,SAFD,MAGK,IAAI,IAAI,eAAR,EAAyB;AAC5B,YAAE,eAAF;AACD;AACF,OAVS,EAWV,YAAW;AACT,uBAAe,IAAf,CAAoB,gBAApB;AACD,OAbS;AADN;AAjBgC,GAAnB,CAAvB;;;AAqCA,mBAAiB,EAAjB;AACA,mBAAiB,CACf,gBADe,EAEf,gBAFe,EAGf,iBAHe,CAAjB;AAKA,MAAI,oBAAoB,IAAI,gBAAJ,EAAxB;AACA,oBAAkB,eAAlB,GAAoC,KAApC;AACA,oBAAkB,wBAAlB,GAA6C,KAA7C;AACA,oBAAkB,IAAlB;AACA,OAAK,KAAL,CAAW,cAAX,EAA2B,cAA3B,EACE,0CADF;;;AAKA,mBAAiB,EAAjB;AACA,mBAAiB,CACf,gBADe,CAAjB;AAGA,oBAAkB,eAAlB,GAAoC,KAApC;AACA,oBAAkB,wBAAlB,GAA6C,IAA7C;AACA,oBAAkB,IAAlB;AACA,OAAK,KAAL,CAAW,cAAX,EAA2B,cAA3B,EACE,kDADF;;;AAKA,mBAAiB,EAAjB;AACA,mBAAiB,CACf,gBADe,EAEf,gBAFe,CAAjB;AAIA,oBAAkB,eAAlB,GAAoC,IAApC;AACA,oBAAkB,wBAAlB,GAA6C,KAA7C;AACA,oBAAkB,IAAlB;AACA,OAAK,KAAL,CAAW,cAAX,EAA2B,cAA3B,EACE,sCADF;AAGD,CA/FD","file":"/packages/jagi:astronomy/test/modules/events/propagation.js.map","sourcesContent":["Tinytest.add('Modules - Events - Propagation', function(test) {\n  // Reset Astro.\n  reset();\n\n  let expectedEvents = [];\n  let executedEvents = [];\n\n  let PropagationNestedEvent = Astro.Class.create({\n    name: 'PropagationNestedEvent',\n    events: {\n      beforeSave: [\n        function(e) {\n          executedEvents.push('PNE.beforeSave1');\n        }\n      ]\n    }\n  });\n\n  let PropagationEvents = new Mongo.Collection(null);\n\n  let PropagationEvent = Astro.Class.create({\n    name: 'PropagationEvent',\n    collection: PropagationEvents,\n    fields: {\n      one: {\n        type: PropagationNestedEvent,\n        default: function() {\n          return new PropagationNestedEvent();\n        }\n      },\n      stopPropagation: {\n        type: Boolean\n      },\n      stopImmediatePropagation: {\n        type: Boolean\n      },\n    },\n    events: {\n      beforeSave: [\n        function(e) {\n          var doc = e.currentTarget;\n          executedEvents.push('PE.beforeSave1');\n          if (doc.stopImmediatePropagation) {\n            e.stopImmediatePropagation();\n          }\n          else if (doc.stopPropagation) {\n            e.stopPropagation();\n          }\n        },\n        function() {\n          executedEvents.push('PE.beforeSave2');\n        }\n      ]\n    }\n  });\n\n  // Propagation NOT stopped.\n  executedEvents = [];\n  expectedEvents = [\n    'PE.beforeSave1',\n    'PE.beforeSave2',\n    'PNE.beforeSave1'\n  ];\n  let eventsPropagation = new PropagationEvent();\n  eventsPropagation.stopPropagation = false;\n  eventsPropagation.stopImmediatePropagation = false;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents,\n    'Events propagation should not be stopped'\n  );\n\n  // Propagation immediately stopped.\n  executedEvents = [];\n  expectedEvents = [\n    'PE.beforeSave1'\n  ];\n  eventsPropagation.stopPropagation = false;\n  eventsPropagation.stopImmediatePropagation = true;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents,\n    'Events propagation should be stopped immediately'\n  );\n\n  // Propagation stopped.\n  executedEvents = [];\n  expectedEvents = [\n    'PE.beforeSave1',\n    'PE.beforeSave2'\n  ];\n  eventsPropagation.stopPropagation = true;\n  eventsPropagation.stopImmediatePropagation = false;\n  eventsPropagation.save();\n  test.equal(executedEvents, expectedEvents,\n    'Events propagation should be stopped'\n  );\n});"]},"hash":"7f031292e00c7b8aa1ce0c19137761c032c7d463"}
