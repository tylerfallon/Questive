{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/jagi:astronomy/test/modules/events/order.js","filenameRelative":"/packages/jagi:astronomy/test/modules/events/order.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/jagi:astronomy/test/modules/events/order.js.map","sourceFileName":"/packages/jagi:astronomy/test/modules/events/order.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"order"},"ignored":false,"code":"Tinytest.add('Modules - Events - Order', function (test) {\n\tvar executedEvents = [];\n\tvar expectedEvents = [];\n\n\tvar OrderNestedEvent = Astro.Class.create({\n\t\tname: 'OrderNestedEvent',\n\t\tevents: {\n\t\t\tbeforeInit: function () {\n\t\t\t\tfunction beforeInit(e) {\n\t\t\t\t\texecutedEvents.push('ONE.beforeInit');\n\t\t\t\t}\n\n\t\t\t\treturn beforeInit;\n\t\t\t}(),\n\t\t\tafterInit: function () {\n\t\t\t\tfunction afterInit(e) {\n\t\t\t\t\texecutedEvents.push('ONE.afterInit');\n\t\t\t\t}\n\n\t\t\t\treturn afterInit;\n\t\t\t}(),\n\t\t\tbeforeSave: function () {\n\t\t\t\tfunction beforeSave(e) {\n\t\t\t\t\texecutedEvents.push('ONE.beforeSave');\n\t\t\t\t}\n\n\t\t\t\treturn beforeSave;\n\t\t\t}(),\n\t\t\tafterSave: function () {\n\t\t\t\tfunction afterSave(e) {\n\t\t\t\t\texecutedEvents.push('ONE.afterSave');\n\t\t\t\t}\n\n\t\t\t\treturn afterSave;\n\t\t\t}(),\n\t\t\tbeforeInsert: function () {\n\t\t\t\tfunction beforeInsert(e) {\n\t\t\t\t\texecutedEvents.push('ONE.beforeInsert');\n\t\t\t\t}\n\n\t\t\t\treturn beforeInsert;\n\t\t\t}(),\n\t\t\tafterInsert: function () {\n\t\t\t\tfunction afterInsert(e) {\n\t\t\t\t\texecutedEvents.push('ONE.afterInsert');\n\t\t\t\t}\n\n\t\t\t\treturn afterInsert;\n\t\t\t}(),\n\t\t\tbeforeUpdate: function () {\n\t\t\t\tfunction beforeUpdate(e) {\n\t\t\t\t\texecutedEvents.push('ONE.beforeUpdate');\n\t\t\t\t}\n\n\t\t\t\treturn beforeUpdate;\n\t\t\t}(),\n\t\t\tafterUpdate: function () {\n\t\t\t\tfunction afterUpdate(e) {\n\t\t\t\t\texecutedEvents.push('ONE.afterUpdate');\n\t\t\t\t}\n\n\t\t\t\treturn afterUpdate;\n\t\t\t}()\n\t\t}\n\t});\n\n\tvar OrderEvents = new Mongo.Collection(null);\n\n\tvar OrderEvent = Astro.Class.create({\n\t\tname: 'OrderEvent',\n\t\tcollection: OrderEvents,\n\t\tfields: {\n\t\t\tone: {\n\t\t\t\ttype: OrderNestedEvent,\n\t\t\t\t'default': function () {\n\t\t\t\t\tfunction _default() {\n\t\t\t\t\t\treturn new OrderNestedEvent();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn _default;\n\t\t\t\t}()\n\t\t\t},\n\t\t\tmany: {\n\t\t\t\ttype: [OrderNestedEvent],\n\t\t\t\t'default': function () {\n\t\t\t\t\tfunction _default() {\n\t\t\t\t\t\treturn [new OrderNestedEvent()];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn _default;\n\t\t\t\t}()\n\t\t\t},\n\t\t\tstring: {\n\t\t\t\ttype: String,\n\t\t\t\toptional: true\n\t\t\t}\n\t\t},\n\t\tevents: {\n\t\t\tbeforeInit: function () {\n\t\t\t\tfunction beforeInit(e) {\n\t\t\t\t\texecutedEvents.push('OE.beforeInit');\n\t\t\t\t}\n\n\t\t\t\treturn beforeInit;\n\t\t\t}(),\n\t\t\tafterInit: function () {\n\t\t\t\tfunction afterInit(e) {\n\t\t\t\t\texecutedEvents.push('OE.afterInit');\n\t\t\t\t}\n\n\t\t\t\treturn afterInit;\n\t\t\t}(),\n\t\t\tbeforeSave: function () {\n\t\t\t\tfunction beforeSave(e) {\n\t\t\t\t\texecutedEvents.push('OE.beforeSave');\n\t\t\t\t}\n\n\t\t\t\treturn beforeSave;\n\t\t\t}(),\n\t\t\tafterSave: function () {\n\t\t\t\tfunction afterSave(e) {\n\t\t\t\t\texecutedEvents.push('OE.afterSave');\n\t\t\t\t}\n\n\t\t\t\treturn afterSave;\n\t\t\t}(),\n\t\t\tbeforeInsert: function () {\n\t\t\t\tfunction beforeInsert(e) {\n\t\t\t\t\texecutedEvents.push('OE.beforeInsert');\n\t\t\t\t}\n\n\t\t\t\treturn beforeInsert;\n\t\t\t}(),\n\t\t\tafterInsert: function () {\n\t\t\t\tfunction afterInsert(e) {\n\t\t\t\t\texecutedEvents.push('OE.afterInsert');\n\t\t\t\t}\n\n\t\t\t\treturn afterInsert;\n\t\t\t}(),\n\t\t\tbeforeUpdate: function () {\n\t\t\t\tfunction beforeUpdate(e) {\n\t\t\t\t\texecutedEvents.push('OE.beforeUpdate');\n\t\t\t\t}\n\n\t\t\t\treturn beforeUpdate;\n\t\t\t}(),\n\t\t\tafterUpdate: function () {\n\t\t\t\tfunction afterUpdate(e) {\n\t\t\t\t\texecutedEvents.push('OE.afterUpdate');\n\t\t\t\t}\n\n\t\t\t\treturn afterUpdate;\n\t\t\t}()\n\t\t}\n\t});\n\n\t// Document creation.\n\texecutedEvents = [];\n\texpectedEvents = ['OE.beforeInit', 'ONE.beforeInit', 'ONE.afterInit', 'ONE.beforeInit', 'ONE.afterInit', 'OE.afterInit'];\n\tvar event = new OrderEvent();\n\ttest.equal(executedEvents, expectedEvents, 'Wrong events order on a document creation');\n\n\t// Document insertion.\n\texecutedEvents = [];\n\texpectedEvents = ['OE.beforeSave', 'ONE.beforeSave', 'ONE.beforeSave', 'OE.beforeInsert', 'ONE.beforeInsert', 'ONE.beforeInsert', 'OE.afterInsert', 'ONE.afterInsert', 'ONE.afterInsert', 'OE.afterSave', 'ONE.afterSave', 'ONE.afterSave'];\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents, 'Wrong events order on a document insert');\n\n\t// Document update without changes.\n\texecutedEvents = [];\n\texpectedEvents = ['OE.beforeInit', 'ONE.beforeInit', 'ONE.afterInit', 'ONE.beforeInit', 'ONE.afterInit', 'OE.afterInit'];\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents, 'Wrong events order on a document update without changes');\n\n\t// Document update with changes.\n\texecutedEvents = [];\n\texpectedEvents = ['OE.beforeInit', 'ONE.beforeInit', 'ONE.afterInit', 'ONE.beforeInit', 'ONE.afterInit', 'OE.afterInit', 'OE.beforeSave', 'ONE.beforeSave', 'ONE.beforeSave', 'OE.beforeUpdate', 'ONE.beforeUpdate', 'ONE.beforeUpdate', 'OE.beforeInit', 'ONE.beforeInit', 'ONE.afterInit', 'ONE.beforeInit', 'ONE.afterInit', 'OE.afterInit', 'OE.afterUpdate', 'ONE.afterUpdate', 'ONE.afterUpdate', 'OE.afterSave', 'ONE.afterSave', 'ONE.afterSave'];\n\tevent.string = 'abc';\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents, 'Wrong events order on a document update with changes');\n});","ast":null,"map":{"version":3,"sources":["/packages/jagi:astronomy/test/modules/events/order.js"],"names":[],"mappings":"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","file":"/packages/jagi:astronomy/test/modules/events/order.js.map","sourcesContent":["Tinytest.add('Modules - Events - Order', function(test) {\n\tlet executedEvents = [];\n\tlet expectedEvents = [];\n\n\tlet OrderNestedEvent = Astro.Class.create({\n\t\tname: 'OrderNestedEvent',\n\t\tevents: {\n\t\t\tbeforeInit: function(e) {\n\t\t\t\texecutedEvents.push('ONE.beforeInit');\n\t\t\t},\n\t\t\tafterInit: function(e) {\n\t\t\t\texecutedEvents.push('ONE.afterInit');\n\t\t\t},\n\t\t\tbeforeSave: function(e) {\n\t\t\t\texecutedEvents.push('ONE.beforeSave');\n\t\t\t},\n\t\t\tafterSave: function(e) {\n\t\t\t\texecutedEvents.push('ONE.afterSave');\n\t\t\t},\n\t\t\tbeforeInsert: function(e) {\n\t\t\t\texecutedEvents.push('ONE.beforeInsert');\n\t\t\t},\n\t\t\tafterInsert: function(e) {\n\t\t\t\texecutedEvents.push('ONE.afterInsert');\n\t\t\t},\n\t\t\tbeforeUpdate: function(e) {\n\t\t\t\texecutedEvents.push('ONE.beforeUpdate');\n\t\t\t},\n\t\t\tafterUpdate: function(e) {\n\t\t\t\texecutedEvents.push('ONE.afterUpdate');\n\t\t\t}\n\t\t}\n\t});\n\n\tlet OrderEvents = new Mongo.Collection(null);\n\n\tlet OrderEvent = Astro.Class.create({\n\t\tname: 'OrderEvent',\n\t\tcollection: OrderEvents,\n\t\tfields: {\n\t\t\tone: {\n\t\t\t\ttype: OrderNestedEvent,\n\t\t\t\tdefault: function() {\n\t\t\t\t\treturn new OrderNestedEvent();\n\t\t\t\t}\n\t\t\t},\n\t\t\tmany: {\n\t\t\t\ttype: [OrderNestedEvent],\n\t\t\t\tdefault: function() {\n\t\t\t\t\treturn [new OrderNestedEvent()];\n\t\t\t\t}\n\t\t\t},\n\t\t\tstring: {\n\t\t\t\ttype: String,\n\t\t\t\toptional: true\n\t\t\t}\n\t\t},\n\t\tevents: {\n\t\t\tbeforeInit: function(e) {\n\t\t\t\texecutedEvents.push('OE.beforeInit');\n\t\t\t},\n\t\t\tafterInit: function(e) {\n\t\t\t\texecutedEvents.push('OE.afterInit');\n\t\t\t},\n\t\t\tbeforeSave: function(e) {\n\t\t\t\texecutedEvents.push('OE.beforeSave');\n\t\t\t},\n\t\t\tafterSave: function(e) {\n\t\t\t\texecutedEvents.push('OE.afterSave');\n\t\t\t},\n\t\t\tbeforeInsert: function(e) {\n\t\t\t\texecutedEvents.push('OE.beforeInsert');\n\t\t\t},\n\t\t\tafterInsert: function(e) {\n\t\t\t\texecutedEvents.push('OE.afterInsert');\n\t\t\t},\n\t\t\tbeforeUpdate: function(e) {\n\t\t\t\texecutedEvents.push('OE.beforeUpdate');\n\t\t\t},\n\t\t\tafterUpdate: function(e) {\n\t\t\t\texecutedEvents.push('OE.afterUpdate');\n\t\t\t}\n\t\t}\n\t});\n\n\t// Document creation.\n\texecutedEvents = [];\n\texpectedEvents = [\n\t\t'OE.beforeInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'OE.afterInit',\n\t];\n\tlet event = new OrderEvent();\n\ttest.equal(executedEvents, expectedEvents,\n\t\t'Wrong events order on a document creation'\n\t);\n\n\t// Document insertion.\n\texecutedEvents = [];\n\texpectedEvents = [\n\t\t'OE.beforeSave',\n\t\t'ONE.beforeSave',\n\t\t'ONE.beforeSave',\n\t\t'OE.beforeInsert',\n\t\t'ONE.beforeInsert',\n\t\t'ONE.beforeInsert',\n\t\t'OE.afterInsert',\n\t\t'ONE.afterInsert',\n\t\t'ONE.afterInsert',\n\t\t'OE.afterSave',\n\t\t'ONE.afterSave',\n\t\t'ONE.afterSave'\n\t];\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents,\n\t\t'Wrong events order on a document insert'\n\t);\n\n\t// Document update without changes.\n\texecutedEvents = [];\n\texpectedEvents = [\n\t\t'OE.beforeInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'OE.afterInit'\n\t];\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents,\n\t\t'Wrong events order on a document update without changes'\n\t);\n\n\t// Document update with changes.\n\texecutedEvents = [];\n\texpectedEvents = [\n\t\t'OE.beforeInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'OE.afterInit',\n\t\t'OE.beforeSave',\n\t\t'ONE.beforeSave',\n\t\t'ONE.beforeSave',\n\t\t'OE.beforeUpdate',\n\t\t'ONE.beforeUpdate',\n\t\t'ONE.beforeUpdate',\n\t\t'OE.beforeInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'ONE.beforeInit',\n\t\t'ONE.afterInit',\n\t\t'OE.afterInit',\n\t\t'OE.afterUpdate',\n\t\t'ONE.afterUpdate',\n\t\t'ONE.afterUpdate',\n\t\t'OE.afterSave',\n\t\t'ONE.afterSave',\n\t\t'ONE.afterSave'\n\t];\n\tevent.string = 'abc';\n\tevent.save();\n\ttest.equal(executedEvents, expectedEvents,\n\t\t'Wrong events order on a document update with changes'\n\t);\n});\n"]},"hash":"b95a6725485a84d9045c14cd595faf18f3a55b9a"}
