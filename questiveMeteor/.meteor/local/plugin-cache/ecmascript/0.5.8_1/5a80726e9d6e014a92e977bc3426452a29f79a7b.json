{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/accounts-password/email_tests_setup.js","filenameRelative":"/packages/accounts-password/email_tests_setup.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/accounts-password/email_tests_setup.js.map","sourceFileName":"/packages/accounts-password/email_tests_setup.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"email_tests_setup"},"ignored":false,"code":"//\n// a mechanism to intercept emails sent to addressing including\n// the string \"intercept\", storing them in an array that can then\n// be retrieved using the getInterceptedEmails method\n//\nvar interceptedEmails = {}; // (email address) -> (array of options)\n\n// add html email templates that just contain the url\nAccounts.emailTemplates.resetPassword.html = Accounts.emailTemplates.enrollAccount.html = Accounts.emailTemplates.verifyEmail.html = function (user, url) {\n  return url;\n};\n\n// override the from address\nAccounts.emailTemplates.resetPassword.from = Accounts.emailTemplates.enrollAccount.from = Accounts.emailTemplates.verifyEmail.from = function (user) {\n  return 'test@meteor.com';\n};\n\n// add a custom header to check against\nAccounts.emailTemplates.headers = {\n  'My-Custom-Header': 'Cool'\n};\n\nEmailTest.hookSend(function (options) {\n  var to = options.to;\n  if (!to || to.indexOf('intercept') === -1) {\n    return true; // go ahead and send\n  } else {\n      if (!interceptedEmails[to]) interceptedEmails[to] = [];\n\n      interceptedEmails[to].push(options);\n      return false; // skip sending\n    }\n});\n\nMeteor.methods({\n  getInterceptedEmails: function () {\n    function getInterceptedEmails(email) {\n      check(email, String);\n      return interceptedEmails[email];\n    }\n\n    return getInterceptedEmails;\n  }(),\n\n  addEmailForTestAndVerify: function () {\n    function addEmailForTestAndVerify(email) {\n      check(email, String);\n      Meteor.users.update({ _id: this.userId }, { $push: { emails: { address: email, verified: false } } });\n      Accounts.sendVerificationEmail(this.userId, email);\n    }\n\n    return addEmailForTestAndVerify;\n  }(),\n\n  createUserOnServer: function () {\n    function createUserOnServer(email) {\n      check(email, String);\n      var userId = Accounts.createUser({ email: email });\n      Accounts.sendEnrollmentEmail(userId);\n      return Meteor.users.findOne(userId);\n    }\n\n    return createUserOnServer;\n  }()\n});","ast":null,"map":{"version":3,"sources":["/packages/accounts-password/email_tests_setup.js"],"names":[],"mappings":";;;;;AAKA,IAAI,oBAAoB,EAAxB,C;;;AAGA,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACA,SAAS,cAAT,CAAwB,WAAxB,CAAoC,IAApC,GAA2C,UAAU,IAAV,EAAgB,GAAhB,EAAqB;AAC9D,SAAO,GAAP;AACD,CAJH;;;AAOA,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,aAAxB,CAAsC,IAAtC,GACE,SAAS,cAAT,CAAwB,WAAxB,CAAoC,IAApC,GAA2C,UAAU,IAAV,EAAgB;AACzD,SAAO,iBAAP;AACD,CAJL;;;AAOA,SAAS,cAAT,CAAwB,OAAxB,GAAkC;AAChC,sBAAqB;AADW,CAAlC;;AAIA,UAAU,QAAV,CAAmB,UAAU,OAAV,EAAmB;AACpC,MAAI,KAAK,QAAQ,EAAjB;AACA,MAAI,CAAC,EAAD,IAAO,GAAG,OAAH,CAAW,WAAX,MAA4B,CAAC,CAAxC,EAA2C;AACzC,WAAO,IAAP,C;AACD,GAFD,MAEO;AACL,UAAI,CAAC,kBAAkB,EAAlB,CAAL,EACE,kBAAkB,EAAlB,IAAwB,EAAxB;;AAEF,wBAAkB,EAAlB,EAAsB,IAAtB,CAA2B,OAA3B;AACA,aAAO,KAAP,C;AACD;AACF,CAXD;;AAaA,OAAO,OAAP,CAAe;AACb;AAAsB,kCAAU,KAAV,EAAiB;AACrC,YAAM,KAAN,EAAa,MAAb;AACA,aAAO,kBAAkB,KAAlB,CAAP;AACD;;AAHD;AAAA,KADa;;AAMb;AAA0B,sCAAU,KAAV,EAAiB;AACzC,YAAM,KAAN,EAAa,MAAb;AACA,aAAO,KAAP,CAAa,MAAb,CACE,EAAC,KAAK,KAAK,MAAX,EADF,EAEE,EAAC,OAAO,EAAC,QAAQ,EAAC,SAAS,KAAV,EAAiB,UAAU,KAA3B,EAAT,EAAR,EAFF;AAGA,eAAS,qBAAT,CAA+B,KAAK,MAApC,EAA4C,KAA5C;AACD;;AAND;AAAA,KANa;;AAcb;AAAoB,gCAAU,KAAV,EAAiB;AACnC,YAAM,KAAN,EAAa,MAAb;AACA,UAAI,SAAS,SAAS,UAAT,CAAoB,EAAC,OAAO,KAAR,EAApB,CAAb;AACA,eAAS,mBAAT,CAA6B,MAA7B;AACA,aAAO,OAAO,KAAP,CAAa,OAAb,CAAqB,MAArB,CAAP;AACD;;AALD;AAAA;AAda,CAAf","file":"/packages/accounts-password/email_tests_setup.js.map","sourcesContent":["//\n// a mechanism to intercept emails sent to addressing including\n// the string \"intercept\", storing them in an array that can then\n// be retrieved using the getInterceptedEmails method\n//\nvar interceptedEmails = {}; // (email address) -> (array of options)\n\n// add html email templates that just contain the url\nAccounts.emailTemplates.resetPassword.html =\n  Accounts.emailTemplates.enrollAccount.html =\n  Accounts.emailTemplates.verifyEmail.html = function (user, url) {\n    return url;\n  };\n\n// override the from address\nAccounts.emailTemplates.resetPassword.from =\n  Accounts.emailTemplates.enrollAccount.from =\n    Accounts.emailTemplates.verifyEmail.from = function (user) {\n      return 'test@meteor.com';\n    };\n\n// add a custom header to check against\nAccounts.emailTemplates.headers = {\n  'My-Custom-Header' : 'Cool'\n};\n\nEmailTest.hookSend(function (options) {\n  var to = options.to;\n  if (!to || to.indexOf('intercept') === -1) {\n    return true; // go ahead and send\n  } else {\n    if (!interceptedEmails[to])\n      interceptedEmails[to] = [];\n\n    interceptedEmails[to].push(options);\n    return false; // skip sending\n  }\n});\n\nMeteor.methods({\n  getInterceptedEmails: function (email) {\n    check(email, String);\n    return interceptedEmails[email];\n  },\n\n  addEmailForTestAndVerify: function (email) {\n    check(email, String);\n    Meteor.users.update(\n      {_id: this.userId},\n      {$push: {emails: {address: email, verified: false}}});\n    Accounts.sendVerificationEmail(this.userId, email);\n  },\n\n  createUserOnServer: function (email) {\n    check(email, String);\n    var userId = Accounts.createUser({email: email});\n    Accounts.sendEnrollmentEmail(userId);\n    return Meteor.users.findOne(userId);\n  }\n});\n"]},"hash":"5a80726e9d6e014a92e977bc3426452a29f79a7b"}
