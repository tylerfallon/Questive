{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"../../fields/utils/cast_nested.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"castNested"}]},{"source":"../utils/document_validate.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"documentValidate"}]},{"source":"../../storage/utils/call_meteor_method.js","imported":["default"],"specifiers":[{"kind":"named","imported":"default","local":"callMeteorMethod"}]}],"exports":{"exported":[],"specifiers":[]}}},"options":{"filename":"/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js","filenameRelative":"/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js","env":{},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],{"loose":true}],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"loose":true}],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],null]],"ignore":[],"code":true,"metadata":true,"ast":false,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js.map","sourceFileName":"/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"basename":"validate"},"ignored":false,"code":"var castNested;module.import('../../fields/utils/cast_nested.js',{\"default\":function(v){castNested=v}});var documentValidate;module.import('../utils/document_validate.js',{\"default\":function(v){documentValidate=v}});var callMeteorMethod;module.import('../../storage/utils/call_meteor_method.js',{\"default\":function(v){callMeteorMethod=v}});\n\n\n\nfunction validate() {\n  var args = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n  var callback = arguments[1];\n\n  var doc = this;\n  var Class = doc.constructor;\n  var Collection = Class.getCollection();\n  var connection = Collection && Collection._connection;\n  if (!connection && (!Collection || !Collection._name)) {\n    connection = Meteor.connection;\n  }\n\n  // If the first argument is callback function then reassign values.\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  }\n\n  var _args = args;\n  var _args$fields = _args.fields;\n  var fields = _args$fields === undefined ? Class.getValidationOrder() : _args$fields;\n  var _args$stopOnFirstErro = _args.stopOnFirstError;\n  var stopOnFirstError = _args$stopOnFirstErro === undefined ? true : _args$stopOnFirstErro;\n  var _args$simulation = _args.simulation;\n  var simulation = _args$simulation === undefined ? true : _args$simulation;\n\n  // If a fields property is a string then put it into array.\n\n  if (Match.test(fields, String)) {\n    fields = [fields];\n  }\n\n  // Cast nested documents.\n  castNested({\n    doc: doc\n  });\n\n  // Prepare arguments for meteor method and utility.\n  var methodArgs = {\n    doc: doc,\n    fields: fields,\n    stopOnFirstError: stopOnFirstError,\n    simulation: simulation\n  };\n\n  // If we are dealing with a remote collection and we are not on the server.\n  if (connection && connection !== Meteor.server) {\n    // Prepare arguments for meteor method.\n    var methodName = '/Astronomy/validate';\n\n    try {\n      // Run Meteor method.\n      return callMeteorMethod(Class, methodName, [methodArgs], callback);\n    }\n    // Catch stub exceptions.\n    catch (err) {\n      if (callback) {\n        callback(err);\n        return null;\n      }\n      throw err;\n    }\n  }\n\n  // If we can just validate a document without calling the meteor method. We\n  // may be on the server or the collection may be local.\n  try {\n    // Validate a document.\n    var result = documentValidate(methodArgs);\n    if (callback) {\n      callback();\n    }\n    return result;\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n    throw err;\n  }\n}\n\nmodule.export(\"default\",exports.default=(validate));","ast":null,"map":{"version":3,"sources":["/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js"],"names":[],"mappings":"AAAA,OAAO,UAAP,MAAuB,mCAAvB;AACA,OAAO,gBAAP,MAA6B,+BAA7B;AACA,OAAO,gBAAP,MAA6B,2CAA7B;;AAEA,SAAS,QAAT,GAAuC;AAAA,MAArB,IAAqB,yDAAd,EAAc;AAAA,MAAV,QAAU;;AACrC,MAAI,MAAM,IAAV;AACA,MAAI,QAAQ,IAAI,WAAhB;AACA,MAAI,aAAa,MAAM,aAAN,EAAjB;AACA,MAAI,aAAa,cAAc,WAAW,WAA1C;AACA,MAAI,CAAC,UAAD,KAAgB,CAAC,UAAD,IAAe,CAAC,WAAW,KAA3C,CAAJ,EAAuD;AACrD,iBAAa,OAAO,UAApB;AACD;;;AAGD,MAAI,UAAU,MAAV,KAAqB,CAArB,IAA0B,MAAM,IAAN,CAAW,IAAX,EAAiB,QAAjB,CAA9B,EAA0D;AACxD,eAAW,IAAX;AACA,WAAO,EAAP;AACD;;AAboC,cAmBjC,IAnBiC;AAAA,2BAgBnC,MAhBmC;AAAA,MAgBnC,MAhBmC,gCAgB1B,MAAM,kBAAN,EAhB0B;AAAA,oCAiBnC,gBAjBmC;AAAA,MAiBnC,gBAjBmC,yCAiBhB,IAjBgB;AAAA,+BAkBnC,UAlBmC;AAAA,MAkBnC,UAlBmC,oCAkBtB,IAlBsB;;;;AAsBrC,MAAI,MAAM,IAAN,CAAW,MAAX,EAAmB,MAAnB,CAAJ,EAAgC;AAC9B,aAAS,CAAC,MAAD,CAAT;AACD;;;AAGD,aAAW;AACT;AADS,GAAX;;;AAKA,MAAI,aAAa;AACf,YADe;AAEf,kBAFe;AAGf,sCAHe;AAIf;AAJe,GAAjB;;;AAQA,MAAI,cAAc,eAAe,OAAO,MAAxC,EAAgD;;AAE9C,QAAI,aAAa,qBAAjB;;AAEA,QAAI;;AAEF,aAAO,iBACL,KADK,EACE,UADF,EACc,CAAC,UAAD,CADd,EAC4B,QAD5B,CAAP;AAGD;;AAED,WAAO,GAAP,EAAY;AACV,UAAI,QAAJ,EAAc;AACZ,iBAAS,GAAT;AACA,eAAO,IAAP;AACD;AACD,YAAM,GAAN;AACD;AACF;;;;AAID,MAAI;;AAEF,QAAI,SAAS,iBAAiB,UAAjB,CAAb;AACA,QAAI,QAAJ,EAAc;AACZ;AACD;AACD,WAAO,MAAP;AACD,GAPD,CAQA,OAAO,GAAP,EAAY;AACV,QAAI,QAAJ,EAAc;AACZ,eAAS,GAAT;AACA,aAAO,IAAP;AACD;AACD,UAAM,GAAN;AACD;AACF;;AAED,eAAe,QAAf","file":"/packages/jagi:astronomy/lib/modules/validators/class_prototype_methods/validate.js.map","sourcesContent":["import castNested from '../../fields/utils/cast_nested.js';\nimport documentValidate from '../utils/document_validate.js';\nimport callMeteorMethod from '../../storage/utils/call_meteor_method.js';\n\nfunction validate(args = {}, callback) {\n  let doc = this;\n  let Class = doc.constructor;\n  let Collection = Class.getCollection();\n  let connection = Collection && Collection._connection;\n  if (!connection && (!Collection || !Collection._name)) {\n    connection = Meteor.connection;\n  }\n\n  // If the first argument is callback function then reassign values.\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  }\n\n  let {\n    fields = Class.getValidationOrder(),\n    stopOnFirstError = true,\n    simulation = true,\n  } = args;\n\n  // If a fields property is a string then put it into array.\n  if (Match.test(fields, String)) {\n    fields = [fields];\n  }\n\n  // Cast nested documents.\n  castNested({\n    doc\n  });\n\n  // Prepare arguments for meteor method and utility.\n  let methodArgs = {\n    doc,\n    fields,\n    stopOnFirstError,\n    simulation,\n  };\n\n  // If we are dealing with a remote collection and we are not on the server.\n  if (connection && connection !== Meteor.server) {\n    // Prepare arguments for meteor method.\n    let methodName = '/Astronomy/validate';\n\n    try {\n      // Run Meteor method.\n      return callMeteorMethod(\n        Class, methodName, [methodArgs], callback\n      );\n    }\n    // Catch stub exceptions.\n    catch (err) {\n      if (callback) {\n        callback(err);\n        return null;\n      }\n      throw err;\n    }\n  }\n\n  // If we can just validate a document without calling the meteor method. We\n  // may be on the server or the collection may be local.\n  try {\n    // Validate a document.\n    let result = documentValidate(methodArgs);\n    if (callback) {\n      callback();\n    }\n    return result;\n  }\n  catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n    throw err;\n  }\n}\n\nexport default validate;"]},"hash":"db939fe0297534226e90c068b9eb3600c87a0472"}
